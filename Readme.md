# Mailing service (test task)

---
### Загрузка
```shell 
git clone https://gitlab.com/Asada_rain/fabrique.git
```
```shell
cd fabrique
```

### Настройка зависимостей

Cкопировать содержимое `.env.example` в файл `.env` и указать зависмости 
```shell
touch .env
````
```
cp example.env .env
```

### Запуск

```shell
docker compose up --build 
```

---
Супер пользователь создается автоматически, нужно указать его параметры в файле `.env`

---

## Enpoints:

![My image](https://i.ibb.co/rdqcsQQ/2023-11-01-07-18-25.png)

### prometheus metrics:

```djangourlpath
http://localhost:9090/
```
![Prometheus](https://i.ibb.co/QM32y6g/2023-11-01-07-26-17.png)

### admin page
```djangourlpath
http://localhost:8000/admin/
```
![Prometheus](https://i.ibb.co/Bq1rFXY/2023-11-01-07-32-58.png)


## Дополнительные требования (8/12)
    
- [x] Организовать тестирование написанного кода
- [ ] Обеспечить автоматическую сборку/тестирование с помощью GitLab CI
- [x] Подготовить docker-compose для запуска всех сервисов проекта одной командой
- [ ] Написать конфигурационные файлы (deployment, ingress, …) для запуска проекта в kubernetes и описать как их применить к работающему кластеру
- [x] сделать так, чтобы по адресу /docs/ открывалась страница со Swagger UI и в нём отображалось описание разработанного API. Пример: https://petstore.swagger.io
- [ ] реализовать администраторский Web UI для управления рассылками и получения статистики по отправленным сообщениям
- [ ] обеспечить интеграцию с внешним OAuth2 сервисом авторизации для административного интерфейса. Пример: https://auth0.com
- [x] реализовать дополнительный сервис, который раз в сутки отправляет статистику по обработанным рассылкам на email
- [x] удаленный сервис может быть недоступен, долго отвечать на запросы или выдавать некорректные ответы. Необходимо организовать обработку ошибок и откладывание запросов при неуспехе для последующей повторной отправки. Задержки в работе внешнего сервиса никак не должны оказывать влияние на работу сервиса рассылок.  - id рассылки - все логи по конкретной рассылке (и запросы на api и внешние запросы на отправку конкретных сообщений)
- [x] реализовать отдачу метрик в формате prometheus и задокументировать эндпоинты и экспортируемые метрики
- [x] реализовать дополнительную бизнес-логику: добавить в сущность "рассылка" поле "временной интервал", в котором можно задать промежуток времени, в котором клиентам можно отправлять сообщения с учётом их локального времени. Не отправлять клиенту сообщение, если его локальное время не входит в указанный интервал.
- [x] обеспечить подробное логирование на всех этапах обработки запросов, чтобы при эксплуатации была возможность найти в логах всю информацию по
  - id рассылки - все логи по конкретной рассылке (и запросы на api и внешние запросы на отправку конкретных сообщений)
  - id сообщения - по конкретному сообщению (все запросы и ответы от внешнего сервиса, вся обработка конкретного сообщения)
  - id клиента - любые операции, которые связаны с конкретным клиентом (добавление/редактирование/отправка сообщения/…)

---

Stack: `Django`, `DRF`, `Postgres`, `Celery`, `Redis`
